<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrarse</title>
  <!-- CSS -->
  <link href="https://framework-gb.cdn.gob.mx/favicon.ico" rel="shortcut icon">
  <link href="https://framework-gb.cdn.gob.mx/assets/styles/main.css" rel="stylesheet">
  <style>
    .logs-form {
      padding: 60px;
      margin: 40px 0 70px;
      border: 1px solid #eee;
      border-radius: 4px;
      background-color: #f5f5f5;
    }
  
    .more-links {
      margin-top: 20px;
    }
  
    .more-links>a {
      display: block;
      margin: 5px 0;
    }
  
    /*
      ** Validatons
      ** -------------------------
      */
  
    .invalid-text {
      color: #f3093b;
    }
  
    .is-invalid {
      border-color: #f3093b;
    }
  
    .is-invalid:focus {
      border-color: #f3093b;
      outline: 0;
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(194, 4, 4, 0.6);
    }
  </style>

  <!-- Respond.js soporte de media queries para Internet Explorer 8 -->
  <!-- ie8.js EventTarget para cada nodo en Internet Explorer 8 -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/ie8/0.2.2/ie8.js"></script>
    <![endif]-->

</head>

<body>

  <!-- Contenido -->
  <main class="page">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <h1>Registrarse</h1>
          <form action="/api/users" method="post" class="logs-form">
            <div class="form-group">
              <label for="register-email">Correo electrónico:</label>
              <input type="email" class="form-control" name="email" id="register-email" placeholder="Ingresa tu correo electrónico">
            </div>
            <div class="form-group">
              <label for="register-password">Contraseña:</label>
              <input type="password" class="form-control" name="password" id="register-password" placeholder="Ingresa tu contraseña">
              <small class="text-help">La contraseña debe tener al menos 6 caractéres</small>
            </div>
            <div class="form-group">
              <label for="register-password-again">Repetir ontraseña:</label>
              <input type="password" class="form-control" name="confirm_password" id="register-password-again" placeholder="Ingresa tu contraseña nuevamente">
              <small class="text-help">La contraseña debe coincidir con la anterior</small>
            </div>
            <button type="submit" class="btn btn-primary btn-block" disabled="disabled">Registrarse</button>
            <div class="form-group more-links">
              <a href="/">Ya tengo cuenta</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://framework-gb.cdn.gob.mx/gobmx.js"></script>
  <script>
    (function () {
      var app = {
        init: function () {
          app.interactions();
        },

        interactions: function () {
          app.validate_register();
        },

        validate_register: function () {
          var $email = $('#register-email');
          var $pass = $('#register-password');
          var $passAgain = $('#register-password-again');
          var $submit = $('button[type="submit"]');

          // Se desabilita el botón por si se refresca la página
          $submit.attr('disabled', 'disabled');

          // Valida la entrada del email cuando pierde su foco
          $email.focusout(function () {
            $email.parent().find('.invalid-text').remove();

            if (!app.validate_email($email.val())) {
              $email.addClass('is-invalid');
              $email.parent().append('<small class="invalid-text">Por favor ingresa un correo electrónico válido</small>');
            } else {
              $email.removeClass('is-invalid');
            }
          });

          // Valida la entrada del password cuando pierde su foco
          $pass.bind('focusout, keyup', function () {
            $pass.parent().find('.text-help').remove();
            $pass.parent().find('.invalid-text').remove();

            if ($pass.val().length < 6) {
              $pass.addClass('is-invalid');
              $pass.parent().append('<small class="invalid-text">La contraseña debe contener al menos 6 caractéres</small>');
            } else {
              $pass.removeClass('is-invalid');
              $pass.parent().append('<small class="text-help">La contraseña debe contener al menos 6 caractéres</small>');
            }
          });

          // Valida la entrada de los dos passwords al presionar una tecla
          $passAgain.keyup(function () {
            $passAgain.parent().find('.text-help').remove();
            $passAgain.parent().find('.invalid-text').remove();

            if ($pass.val() !== $passAgain.val()) {
              $passAgain.addClass('is-invalid');
              $passAgain.parent().append('<small class="invalid-text">La contraseña debe contener al menos 6 caractéres</small>');
            } else {
              $passAgain.removeClass('is-invalid');
              $passAgain.parent().append('<small class="text-help">La contraseña debe contener al menos 6 caractéres</small>');
            }
          });

          // Valida las entradas del registro cada que se presiona una tecla
          $('#register-email, #register-password, #register-password-again').keyup(function () {
            if (app.validate_email($email.val()) && $pass.val().length > 5 && $passAgain.val().length > 5) {
              $('#register-email, #register-password, #register-password-again').removeClass('is-invalid');
              $('.invalid-text').remove();
              $submit.attr('disabled', false);
            } else { $submit.attr('disabled', true); }
          });
        },

        validate_email: function (email) {
          var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
          return re.test(String(email).toLowerCase());
        }
      };

      $(document).ready(app.init);
    })();
  </script>

</body>

</html>